<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="de"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Setting both Celery and Flask inside the docker-compose" /><meta property="og:locale" content="en" /><meta name="description" content="Setting both Celery and Flask inside the docker-compose" /><meta property="og:description" content="Setting both Celery and Flask inside the docker-compose" /><link rel="canonical" href="https://samueltyh.github.io/posts/setting-both-celery-and-flask-inside-the-docker-compose/" /><meta property="og:url" content="https://samueltyh.github.io/posts/setting-both-celery-and-flask-inside-the-docker-compose/" /><meta property="og:site_name" content="samueltyh" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-02-04T01:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Setting both Celery and Flask inside the docker-compose" /><meta name="twitter:site" content="@samueltyh" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-06T23:48:28+02:00","datePublished":"2020-02-04T01:00:00+01:00","description":"Setting both Celery and Flask inside the docker-compose","headline":"Setting both Celery and Flask inside the docker-compose","mainEntityOfPage":{"@type":"WebPage","@id":"https://samueltyh.github.io/posts/setting-both-celery-and-flask-inside-the-docker-compose/"},"url":"https://samueltyh.github.io/posts/setting-both-celery-and-flask-inside-the-docker-compose/"}</script><title>Setting both Celery and Flask inside the docker-compose | samueltyh</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="samueltyh"><meta name="application-name" content="samueltyh"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/AvatarMaker.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">samueltyh</a></div><div class="site-subtitle font-italic">DevOps, Data Engineering, Data Science</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/samueltyh" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/samueltyh" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['samueltseng','icloud.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Setting both Celery and Flask inside the docker-compose</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Setting both Celery and Flask inside the docker-compose</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1580774400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 4, 2020 </em> </span> <span> Updated <em class="" data-ts="1659822508" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 6, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/samueltyh">Samuel Tseng</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="635 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><h2 id="setting-both-celery-and-flask-inside-the-docker-compose"><span class="mr-2">Setting both Celery and Flask inside the docker-compose</span><a href="#setting-both-celery-and-flask-inside-the-docker-compose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Due to the issue I need to resolve is that put the heavy task to background, then run it periodically or asynchronously. And the most important thing is that have to support Python. I found Celery, the excellent tool to implement distributed task queue by Python, can easily deal with request using asynchronous designing. It seems like a perfect solution for my issue, however, there has still a new problem arised, what is I need to focus on processing the task ran by Flask and packed in docker and running by docker compose, it is difficult to find all of these resources at the same time on the Internet. So let’s started!</p><hr /><h4 id="my-article-is-referenced-from-the-following-resources"><span class="mr-2">My article is referenced from the following resources:</span><a href="#my-article-is-referenced-from-the-following-resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li><a href="https://testdriven.io/blog/asynchronous-tasks-with-flask-and-redis-queue/">Asynchronous Tasks with Flask and Redis Queue</a><li><a href="https://github.com/ViktorSalimonov/pylette?source=post_page---------------------------">The web-service for extracting dominant color from images.</a><li><a href="https://blog.miguelgrinberg.com/post/using-celery-with-flask">Using Celery with Flask</a><li><a href="http://andyjin.applinzi.com/?p=1230">Flask + Celery tutorial (Mandarin resource)</a><li><a href="https://forster.site/2016-11-17-celery.html">Task schduling with Celery (Mandarin resource)</a></ol><hr /><h4 id="app-structure-displaying"><span class="mr-2">App Structure Displaying</span><a href="#app-structure-displaying" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>Flask_Celery_example
|
├── api
|   ├── __init__.py
|   ├── app.py               
|   ├── celery_app.py
|   ├── config.py
|   ├── Dockerfile
|   └── requirements.txt
|
├── docker-compose.yml
└── README.md
</pre></table></code></div></div><h4 id="set-up-your-redis-and-celery-worker-in-docker-compose-the-breaking-point-is-to-set-up-the-celery-workers-name-well"><span class="mr-2">Set up your Redis and Celery worker in docker-compose, the breaking point is to set up the celery worker’s name well.</span><a href="#set-up-your-redis-and-celery-worker-in-docker-compose-the-breaking-point-is-to-set-up-the-celery-workers-name-well" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">web</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./api</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5000:5000"</span>
    <span class="na">links</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">FLASK_ENV=development</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./api:/app</span>

  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:5.0.5</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">redis</span>

  <span class="na">worker</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">./api</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">worker</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="s">celery</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">-A celery_app.celery worker --loglevel=info</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./api:/app</span>
    <span class="na">links</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>

</pre></table></code></div></div><h4 id="what-the-dockerfile-in-this-example-looks-like"><span class="mr-2">What the Dockerfile in this example looks like.</span><a href="#what-the-dockerfile-in-this-example-looks-like" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-docker highlighter-rouge"><div class="code-header"> <span data-label-text="Docker"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.6.5</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> requirements.txt ./</span>

<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">EXPOSE</span><span class="s"> 5000</span>

<span class="k">CMD</span><span class="s"> [ "python", "./app.py" ]</span>
</pre></table></code></div></div><h4 id="initialize-celery-worker-and-create-asynchronous-or-scheduled-task-in-celery_apppy"><span class="mr-2">Initialize Celery worker and create asynchronous or scheduled task in celery_app.py</span><a href="#initialize-celery-worker-and-create-asynchronous-or-scheduled-task-in-celery_apppy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">config</span>
<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>


<span class="c1"># Initialize Celery
</span><span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span>
    <span class="s">'worker'</span><span class="p">,</span> 
    <span class="n">broker</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">CeleryConfig</span><span class="p">.</span><span class="n">CELERY_BROKER_URL</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="n">config</span><span class="p">.</span><span class="n">CeleryConfig</span><span class="p">.</span><span class="n">CELERY_RESULT_BACKEND</span>
<span class="p">)</span>


<span class="o">@</span><span class="n">celery</span><span class="p">.</span><span class="n">task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="p">...</span>

</pre></table></code></div></div><h4 id="run-task-by-flask-and-check-its-status-in-apppy"><span class="mr-2">Run task by Flask and check its status in app.py</span><a href="#run-task-by-flask-and-check-its-status-in-apppy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">config</span>
<span class="kn">from</span> <span class="nn">celery_app</span> <span class="kn">import</span> <span class="n">func1</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span>


<span class="c1"># Your API definition
</span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">from_object</span><span class="p">(</span><span class="s">'config.FlaskConfig'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">longtask</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">func1</span><span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'taskstatus'</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="n">task</span><span class="p">.</span><span class="nb">id</span><span class="p">))</span>
    
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/status/&lt;task_id&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">taskstatus</span><span class="p">(</span><span class="n">task_id</span><span class="p">):</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">func1</span><span class="p">.</span><span class="n">AsyncResult</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">task</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="s">'PENDING'</span><span class="p">:</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">SERVER_SLEEP</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'queue_state'</span><span class="p">:</span> <span class="n">task</span><span class="p">.</span><span class="n">state</span><span class="p">,</span>
            <span class="s">'status'</span><span class="p">:</span> <span class="s">'Process is ongoing...'</span><span class="p">,</span>
            <span class="s">'status_update'</span><span class="p">:</span> <span class="n">url_for</span><span class="p">(</span><span class="s">'taskstatus'</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="n">task</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'queue_state'</span><span class="p">:</span> <span class="n">task</span><span class="p">.</span><span class="n">state</span><span class="p">,</span>
            <span class="s">'result'</span><span class="p">:</span> <span class="n">task</span><span class="p">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>

</pre></table></code></div></div><h4 id="after-finishing-the-all-setting-we-can-run-the-script-on-terminal-below-to-create-container-and-run-it"><span class="mr-2">After finishing the all setting, we can run the script on terminal below to create container and run it.</span><a href="#after-finishing-the-all-setting-we-can-run-the-script-on-terminal-below-to-create-container-and-run-it" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd </span>Flask_Celery_example
<span class="nv">$ </span>docker-compose build
<span class="nv">$ </span>docker-compose run
</pre></table></code></div></div><h4 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The bottleneck in this case is that I could run the Flask, Redis, Celery separately in docker-compose at first, but if I want to run it with only one script then it failed. I had tried and error lots of times to finding the breaking point, the correct script to run Celery in docker-compose. Everything was clear after throughing this bottleneck. Thanks for reading my first article! Leave your message below my Facebook post if there’s still any further questions. See you then.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/data-engineering-learning-journey/'>Data Engineering Learning Journey</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/celery/" class="post-tag no-text-decoration" >celery</a> <a href="/tags/flask/" class="post-tag no-text-decoration" >flask</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Setting+both+Celery+and+Flask+inside+the+docker-compose+-+samueltyh&url=https%3A%2F%2Fsamueltyh.github.io%2Fposts%2Fsetting-both-celery-and-flask-inside-the-docker-compose%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Setting+both+Celery+and+Flask+inside+the+docker-compose+-+samueltyh&u=https%3A%2F%2Fsamueltyh.github.io%2Fposts%2Fsetting-both-celery-and-flask-inside-the-docker-compose%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsamueltyh.github.io%2Fposts%2Fsetting-both-celery-and-flask-inside-the-docker-compose%2F&text=Setting+both+Celery+and+Flask+inside+the+docker-compose+-+samueltyh" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/takeaway-unit-testing-of-bash-scripts/">Takeaway: Unit Testing of Bash Scripts</a><li><a href="/posts/learning-and-takeaways-from-kubesimplify-workshop/">Learning and Takeaways from Kubesimplify Workshop</a><li><a href="/posts/setting-both-celery-and-flask-inside-the-docker-compose/">Setting both Celery and Flask inside the docker-compose</a><li><a href="/posts/connect-postgresql-in-docker-container-with-azure-data-studio/">Connect PostgreSQL in docker container with Azure Data Studio</a><li><a href="/posts/how-to-train-a-customized-name-entities-recognition-ner-model-based-on-spacy-pre-trained-model/">How to train a customized Name Entities Recognition (NER) model based on spaCy pre-trained model</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/azure-data-studio/">azure-data-studio</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/celery/">celery</a> <a class="post-tag" href="/tags/cron/">cron</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/etl/">ETL</a> <a class="post-tag" href="/tags/fivetran/">Fivetran</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/learning-and-takeaways-from-kubesimplify-workshop/"><div class="card-body"> <em class="small" data-ts="1659823380" data-df="ll" > Aug 7, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning and Takeaways from Kubesimplify Workshop</h3><div class="text-muted small"><p> This post will keep the learning process and takeaways from the Kubesimplify workshops held by Saiyam Pathak. The motivation for me to catch up on this DevOps topic is to systematically learning by...</p></div></div></a></div><div class="card"> <a href="/posts/connect-postgresql-in-docker-container-with-azure-data-studio/"><div class="card-body"> <em class="small" data-ts="1580860800" data-df="ll" > Feb 5, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Connect PostgreSQL in docker container with Azure Data Studio</h3><div class="text-muted small"><p> Connect PostgreSQL in docker container with Azure Data Studio Azure Data Studio is a cool product that can easily connect MySQL (if you already installed in your system) and show what in your data...</p></div></div></a></div><div class="card"> <a href="/posts/how-to-train-a-customized-name-entities-recognition-ner-model-based-on-spacy-pre-trained-model/"><div class="card-body"> <em class="small" data-ts="1583280000" data-df="ll" > Mar 4, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to train a customized Name Entities Recognition (NER) model based on spaCy pre-trained model</h3><div class="text-muted small"><p> How to train a customized Name Entities Recognition (NER) model based on spaCy pre-trained model There are a bunch of online resources to teach you how to train your own NER model by spaCy, so I w...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></div><a href="/posts/connect-postgresql-in-docker-container-with-azure-data-studio/" class="btn btn-outline-primary" prompt="Newer"><p>Connect PostgreSQL in docker container with Azure Data Studio</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://samueltyh.github.io/posts/setting-both-celery-and-flask-inside-the-docker-compose/'; this.page.identifier = '/posts/setting-both-celery-and-flask-inside-the-docker-compose/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://samuelTyh.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/samueltyh">Samuel Tseng</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/azure-data-studio/">azure-data-studio</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/celery/">celery</a> <a class="post-tag" href="/tags/cron/">cron</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/etl/">ETL</a> <a class="post-tag" href="/tags/fivetran/">Fivetran</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/de.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-7X84VGPKQ1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-7X84VGPKQ1'); }); </script>
